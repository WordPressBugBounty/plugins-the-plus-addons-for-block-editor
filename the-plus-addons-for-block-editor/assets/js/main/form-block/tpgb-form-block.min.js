document.addEventListener("DOMContentLoaded",function(){let e=document.querySelectorAll(".tp-form-block");e.forEach(e=>{let t={},r=!1,a=e.getAttribute("data-block-id");if(a){let o=(e,t)=>{if(!e||!e.hasAttribute("data-required")||"false"===e.getAttribute("data-required"))return!0;let r=e.value.trim(),a=t.getAttribute("data-error-message");return r?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r)?(t.textContent="",!0):(t.textContent=a||"Please enter a valid email address.",!1):(t.textContent=a||"This field is required.",!1)},l=(e,t)=>{if(!e||!e.hasAttribute("data-required")||"false"===e.getAttribute("data-required"))return!0;let r=e.value.trim(),a=t.getAttribute("data-error-message");return r?(t.textContent="",!0):(t.textContent=a||"This field is required.",!1)},n=(e,t)=>{if(!e||!e.hasAttribute("data-required")||"false"===e.getAttribute("data-required"))return t&&(t.textContent=""),!0;let r=e.closest(".tp-form-checkbox-button, .tp-form-radio-button");if(!r)return!0;let a=!1;if("radio"===e.type){let o=r.querySelectorAll(`input[type="radio"][name="${e.name}"]`);a=Array.from(o).some(e=>e.checked)}else{let l=r.querySelectorAll(`input[name="${e.name}"]`);a=Array.from(l).some(e=>e.checked)}let n="This field is required.";if(t&&"function"==typeof t.getAttribute){let i=t.getAttribute("data-error-message");i&&(n=i)}return a?(t&&(t.textContent=""),!0):(t&&(t.textContent=n),!1)},i=e.querySelectorAll(".nxt-name-richtext"),c=e.querySelectorAll(".nxt-email-richtext"),u=e.querySelectorAll(".nxt-message-richtext"),s=e.querySelectorAll(".tp-form-checkbox-button"),d=e.querySelectorAll(".tp-form-radio-button "),f=e.querySelectorAll(".nxt-option-field"),h=e.querySelectorAll(".nxt-number-richtext"),y=e.querySelectorAll(".nxt-error-show"),m=e.querySelectorAll(".nxt-error-email"),b=e.querySelectorAll(".nxt-message-error");e.querySelectorAll(".nxt-error-checkbox"),e.querySelectorAll(".nxt-error-radiobox");let p=e.querySelectorAll(".nxt-error-select"),x=e.querySelectorAll(".nxt-error-number");i.forEach((e,t)=>{e.addEventListener("input",()=>l(e,y[t]))}),c.forEach((e,t)=>{e.addEventListener("input",()=>o(e,m[t]))}),u.forEach((e,t)=>{e.addEventListener("input",()=>l(e,b[t]))}),s.forEach(e=>{let t=e.querySelectorAll('input[type="checkbox"]'),r=e.querySelector(".nxt-error-checkbox");t.forEach(e=>{e.addEventListener("change",()=>n(e,r))})}),d.forEach(e=>{let t=e.querySelectorAll('input[type="radio"]'),r=e.querySelector(".nxt-error-radiobox");t.forEach(e=>{e.addEventListener("change",()=>n(e,r))})}),f.forEach((e,t)=>{e.addEventListener("change",()=>l(e,p[t]))}),h.forEach((e,t)=>{e.addEventListener("input",()=>l(e,x[t]))});let q=()=>{let e=!0;return i.forEach((t,r)=>{if(t.hasAttribute("data-required")){let a=l(t,y[r]);e=e&&a}}),c.forEach((t,r)=>{if(t.hasAttribute("data-required")){let a=o(t,m[r]);e=e&&a}}),u.forEach((t,r)=>{if(t.hasAttribute("data-required")){let a=l(t,b[r]);e=e&&a}}),s.forEach(t=>{let r=t.querySelector('input[type="checkbox"]'),a=t.querySelector(".nxt-error-checkbox");if(r&&r.hasAttribute("data-required")){let o=n(r,a);e=e&&o}}),d.forEach(t=>{let r=t.querySelector('input[type="radio"]'),a=t.querySelector(".nxt-error-radiobox");if(r&&r.hasAttribute("data-required")){let o=n(r,a);e=e&&o}}),f.forEach((t,r)=>{if(t.hasAttribute("data-required")){let a=l(t,p[r]);e=e&&a}}),h.forEach((t,r)=>{if(t.hasAttribute("data-required")){let a=l(t,x[r]);e=e&&a}}),e},A=e.querySelector(".nxt-form");A&&(t=A.getAttribute("data-formdata")||"",A.addEventListener("submit",function a(o){o.preventDefault(),q()&&!r&&(r=!0,function t(a){let o=new FormData,l=t=>{if("checkbox"===t){let r=e.querySelector(".tp-form-checkbox-button");if(r){let a=r.querySelector(".nxt-check-title-label"),o=a?a.innerText.trim():t,l=Array.from(r.querySelectorAll('input[type="checkbox"]:checked')).map(e=>e.value);if(l.length>0)return[{label:o,value:l.join(", ")},]}return[]}return Array.from(e.querySelectorAll(`input[name='${t}'], textarea[name='${t}'], select[name='${t}']`)).filter(e=>"radio"===e.type?e.checked:e.value).map(e=>{let r="email"===e.type?e.closest(".nxt-email-input"):e.classList.contains("nxt-name-richtext")?e.closest(".nxt-name-input"):"number"===e.type?e.closest(".nxt-number-input"):e.parentElement,a=r?r.querySelector("label"):null;return{value:e.value,label:a?a.innerText.trim():t}})};["text-field","email","message","number","select","checkbox",].forEach(e=>l(e).forEach(e=>{o.append(e.label,e.value)})),Array.from(e.querySelectorAll('input[type="radio"]')).forEach(e=>{if(e.checked&&e.name.startsWith("radio-group")){let t=e.closest(".tp-form-radio-button"),r=t?t.querySelector(".nxt-radio-title-label"):null,a=r?r.innerText.trim():e.name;o.append(a,e.value)}}),o.append("actionOption",a||[]),o.append("action","nxt_form_action"),o.append("nonce",tpgb_config.tpgb_nonce);let n=A.hasAttribute("data-actionoption")&&""!==A.getAttribute("data-actionoption").trim()?JSON.parse(A.getAttribute("data-actionoption")).map(e=>e.value):"",i="",c="",u,s,d=(t,r)=>{let a=e.querySelector(".nxt-success-message");a&&(a.textContent=t,a.classList.remove("nxt-success-message","error-message"),a.classList.add(r?"error-message":"nxt-success-message"),a.style.display="block")};if(n&&Array.isArray(n)){let f=n.some(e=>"redirect"===e.toLowerCase());f&&A.hasAttribute("data-redirect")&&(i=A.getAttribute("data-redirect")),f&&A.hasAttribute("data-link-blank")&&(u=A.getAttribute("data-link-blank")),f&&A.hasAttribute("data-link-nofollow")&&(s=A.getAttribute("data-link-nofollow"));let h=n.some(e=>"email"===e.toLowerCase());h&&(c=!0)}let y=e=>{try{return new URL(e),!0}catch(t){return!1}};if(!n||0===n.length){d("No form action is selected.",!0),r=!1;return}if(q()){if(c){let m=e.querySelector(".nxt-submit"),b=m.querySelector(".nxt-loader"),p=m.querySelector(".nxt-button-svg"),x=m.querySelector(".nxt-btn-text");x&&(x.style.opacity="0"),p&&(p.style.opacity="0"),b.style.opacity="1",fetch(tpgb_config.ajax_url,{method:"POST",body:o,credentials:"same-origin",headers:{"X-WP-Nonce":tpgb_config.tpgb_nonce}}).then(e=>e.json()).then(t=>{if(r=!1,b.style.opacity="0",p&&(p.style.opacity="1"),x&&(x.style.opacity="1"),t.success){let a=e.querySelector(".nxt-success-message").getAttribute("data-success-message")||"Your submission was successful.";d(a,!1),setTimeout(()=>{window.location.reload()},1e3)}else{let o=t.data||"Unknown error occurred.";d(o,!0),b.style.opacity="0",p&&(p.style.opacity="1"),x&&(buttonTextstyle.opacity="1")}}).catch(e=>{b.style.opacity="0",p&&(buttonSvgstyle.opacity="1"),x&&(buttonTextstyle.opacity="1"),d("An error occurred while sending the form data.",!0),r=!1})}setTimeout(()=>{if(i&&y(i)){if("1"===u){let e=window.open("","_blank");if("1"===s){let t=e.document.createElement("a");t.setAttribute("href",i),t.setAttribute("rel","nofollow"),e.document.body.appendChild(t),t.click()}else e.location.href=i}else window.location.href=i}},2e3)}}(t))}))}})});