document.addEventListener("DOMContentLoaded",function(){let e=document.querySelectorAll(".tp-form-block");e.forEach(e=>{let t={},r=!1,a=e.getAttribute("data-block-id");if(a){let l=(e,t)=>{if(!e||!e.hasAttribute("data-required")||"false"===e.getAttribute("data-required"))return!0;let r=e.value.trim(),a=t.getAttribute("data-error-message");return r?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r)?(t.textContent="",!0):(t.textContent=a||"Please enter a valid email address.",!1):(t.textContent=a||"This field is required.",!1)},o=(e,t)=>{if(!e||!e.hasAttribute("data-required")||"false"===e.getAttribute("data-required"))return!0;let r=e.value.trim(),a=t.getAttribute("data-error-message");return r?(t.textContent="",!0):(t.textContent=a||"This field is required.",!1)},n=(e,t)=>{if(!e||!e.hasAttribute("data-required")||"false"===e.getAttribute("data-required"))return t&&(t.textContent=""),!0;let r=e.closest(".tp-form-checkbox-button, .tp-form-radio-button");if(!r)return!0;let a=!1;if("radio"===e.type){let l=r.querySelectorAll(`input[type="radio"][name="${e.name}"]`);a=Array.from(l).some(e=>e.checked)}else{let o=r.querySelectorAll(`input[name="${e.name}"]`);a=Array.from(o).some(e=>e.checked)}let n="This field is required.";if(t&&"function"==typeof t.getAttribute){let i=t.getAttribute("data-error-message");i&&(n=i)}return a?(t&&(t.textContent=""),!0):(t&&(t.textContent=n),!1)},i=e.querySelectorAll(".nxt-name-richtext"),c=e.querySelectorAll(".nxt-email-richtext"),u=e.querySelectorAll(".nxt-message-richtext"),s=e.querySelectorAll(".tp-form-checkbox-button"),d=e.querySelectorAll(".tp-form-radio-button "),f=e.querySelectorAll(".nxt-option-field"),p=e.querySelectorAll(".nxt-number-richtext"),h=e.querySelectorAll(".nxt-error-show"),y=e.querySelectorAll(".nxt-error-email"),m=e.querySelectorAll(".nxt-message-error");e.querySelectorAll(".nxt-error-checkbox"),e.querySelectorAll(".nxt-error-radiobox");let b=e.querySelectorAll(".nxt-error-select"),x=e.querySelectorAll(".nxt-error-number");i.forEach((e,t)=>{e.addEventListener("input",()=>o(e,h[t]))}),c.forEach((e,t)=>{e.addEventListener("input",()=>l(e,y[t]))}),u.forEach((e,t)=>{e.addEventListener("input",()=>o(e,m[t]))}),s.forEach(e=>{let t=e.querySelectorAll('input[type="checkbox"]'),r=e.querySelector(".nxt-error-checkbox");t.forEach(e=>{e.addEventListener("change",()=>n(e,r))})}),d.forEach(e=>{let t=e.querySelectorAll('input[type="radio"]'),r=e.querySelector(".nxt-error-radiobox");t.forEach(e=>{e.addEventListener("change",()=>n(e,r))})}),f.forEach((e,t)=>{e.addEventListener("change",()=>o(e,b[t]))}),p.forEach((e,t)=>{e.addEventListener("input",()=>o(e,x[t]))});let q=()=>{let e=!0;return i.forEach((t,r)=>{if(t.hasAttribute("data-required")){let a=o(t,h[r]);e=e&&a}}),c.forEach((t,r)=>{if(t.hasAttribute("data-required")){let a=l(t,y[r]);e=e&&a}}),u.forEach((t,r)=>{if(t.hasAttribute("data-required")){let a=o(t,m[r]);e=e&&a}}),s.forEach(t=>{let r=t.querySelector('input[type="checkbox"]'),a=t.querySelector(".nxt-error-checkbox");if(r&&r.hasAttribute("data-required")){let l=n(r,a);e=e&&l}}),d.forEach(t=>{let r=t.querySelector('input[type="radio"]'),a=t.querySelector(".nxt-error-radiobox");if(r&&r.hasAttribute("data-required")){let l=n(r,a);e=e&&l}}),f.forEach((t,r)=>{if(t.hasAttribute("data-required")){let a=o(t,b[r]);e=e&&a}}),p.forEach((t,r)=>{if(t.hasAttribute("data-required")){let a=o(t,x[r]);e=e&&a}}),e},A=e.querySelector(".nxt-form");A&&(t=A.getAttribute("data-formdata")||"",A.addEventListener("submit",function a(l){l.preventDefault(),q()&&!r&&(r=!0,function t(a){let l=new FormData,o=t=>{if("checkbox"===t){let r=e.querySelector(".tp-form-checkbox-button");if(r){let a=r.querySelector(".nxt-check-title-label"),l=a?a.innerText.trim():t,o=Array.from(r.querySelectorAll('input[type="checkbox"]:checked')).map(e=>e.value);if(o.length>0)return[{label:l,value:o.join(", ")},]}return[]}return Array.from(e.querySelectorAll(`input[name='${t}'], textarea[name='${t}'], select[name='${t}']`)).filter(e=>"radio"===e.type?e.checked:e.value).map(e=>{let r="email"===e.type?e.closest(".nxt-email-input"):e.classList.contains("nxt-name-richtext")?e.closest(".nxt-name-input"):"number"===e.type?e.closest(".nxt-number-input"):e.parentElement,a=r?r.querySelector("label"):null;return{value:e.value,label:a?a.innerText.trim():t}})};["text-field","email","message","number","select","checkbox",].forEach(e=>o(e).forEach(e=>{l.append(e.label,e.value)})),Array.from(e.querySelectorAll('input[type="radio"]')).forEach(e=>{if(e.checked&&e.name.startsWith("radio-group")){let t=e.closest(".tp-form-radio-button"),r=t?t.querySelector(".nxt-radio-title-label"):null,a=r?r.innerText.trim():e.name;l.append(a,e.value)}});let n=e.querySelector('[name="cf-turnstile-response"],[name="g-recaptcha-response"] ');l.append("actionOption",a||[]),l.append("action","nxt_form_action"),l.append("nonce",tpgb_config.tpgb_nonce),n&&l.append("cf-turnstile-response",n.value);let i=A.hasAttribute("data-actionoption")&&""!==A.getAttribute("data-actionoption").trim()?JSON.parse(A.getAttribute("data-actionoption")).map(e=>e.value):"",c="",u="",s,d,f=(t,r)=>{let a=e.querySelector(".nxt-success-message");a&&(a.textContent=t,a.classList.remove("nxt-success-message","error-message"),a.classList.add(r?"error-message":"nxt-success-message"),a.style.display="block")};if(i&&Array.isArray(i)){let p=i.some(e=>"redirect"===e.toLowerCase());p&&A.hasAttribute("data-redirect")&&(c=A.getAttribute("data-redirect")),p&&A.hasAttribute("data-link-blank")&&(s=A.getAttribute("data-link-blank")),p&&A.hasAttribute("data-link-nofollow")&&(d=A.getAttribute("data-link-nofollow"));let h=i.some(e=>"email"===e.toLowerCase());h&&(u=!0)}let y=e=>{try{return new URL(e),!0}catch(t){return!1}};if(!i||0===i.length){f("No form action is selected.",!0),r=!1;return}if(q()){if(u){let m=e.querySelector(".nxt-submit"),b=m.querySelector(".nxt-loader"),x=m.querySelector(".nxt-button-svg"),S=m.querySelector(".nxt-btn-text");S&&(S.style.opacity="0"),x&&(x.style.opacity="0"),b.style.opacity="1",fetch(tpgb_config.ajax_url,{method:"POST",body:l,credentials:"same-origin",headers:{"X-WP-Nonce":tpgb_config.tpgb_nonce}}).then(e=>e.json()).then(t=>{if(r=!1,b.style.opacity="0",x&&(x.style.opacity="1"),S&&(S.style.opacity="1"),t.success){let a=e.querySelector(".nxt-success-message").getAttribute("data-success-message")||"Your submission was successful.";f(a,!1);let l=e.querySelectorAll("input, textarea, select");l.forEach(e=>{"checkbox"===e.type||"radio"===e.type?e.checked=!1:e.value=""})}else{let o=t.data||"Unknown error occurred.";f(o,!0),b.style.opacity="0",x&&(x.style.opacity="1"),S&&(buttonTextstyle.opacity="1")}}).catch(e=>{b.style.opacity="0",x&&(buttonSvgstyle.opacity="1"),S&&(buttonTextstyle.opacity="1"),f("An error occurred while sending the form data.",!0),r=!1})}setTimeout(()=>{if(c&&y(c)){if("1"===s){let e=window.open("","_blank");if("1"===d){let t=e.document.createElement("a");t.setAttribute("href",c),t.setAttribute("rel","nofollow"),e.document.body.appendChild(t),t.click()}else e.location.href=c}else window.location.href=c}},2e3)}}(t))}))}})});