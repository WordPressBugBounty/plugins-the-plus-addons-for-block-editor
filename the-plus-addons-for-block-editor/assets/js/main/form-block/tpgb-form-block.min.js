document.addEventListener("DOMContentLoaded",function(){let e=document.querySelectorAll(".tp-form-block");e.forEach(e=>{let t={},r=!1,l=e.getAttribute("data-block-id");if(l){let a=(e,t)=>{if(!e||!e.hasAttribute("data-required")||"false"===e.getAttribute("data-required"))return!0;let r=e.value.trim(),l=t.getAttribute("data-error-message");return r?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r)?(t.textContent="",!0):(t.textContent=l||"Please enter a valid email address.",!1):(t.textContent=l||"This field is required.",!1)},n=(e,t)=>{if(!e||!e.hasAttribute("data-required")||"false"===e.getAttribute("data-required"))return!0;let r=e.value.trim(),l=t.getAttribute("data-error-message");return r?(t.textContent="",!0):(t.textContent=l||"This field is required.",!1)},o=(e,t)=>{if(!e||!e.hasAttribute("data-required")||"false"===e.getAttribute("data-required"))return t&&(t.textContent=""),!0;let r=e.closest(".tp-form-checkbox-button, .tp-form-radio-button");if(!r)return!0;let l=!1;if("radio"===e.type){let a=r.querySelectorAll(`input[type="radio"][name="${e.name}"]`);l=Array.from(a).some(e=>e.checked)}else{let n=r.querySelectorAll(`input[name="${e.name}"]`);l=Array.from(n).some(e=>e.checked)}let o="This field is required.";if(t&&"function"==typeof t.getAttribute){let i=t.getAttribute("data-error-message");i&&(o=i)}return l?(t&&(t.textContent=""),!0):(t&&(t.textContent=o),!1)},i=e.querySelectorAll(".nxt-name-richtext"),c=e.querySelectorAll(".nxt-email-richtext"),s=e.querySelectorAll(".nxt-message-richtext"),u=e.querySelectorAll(".tp-form-checkbox-button"),d=e.querySelectorAll(".tp-form-radio-button "),f=e.querySelectorAll(".nxt-option-field"),b=e.querySelectorAll(".nxt-number-richtext"),y=e.querySelectorAll(".nxt-error-show"),h=e.querySelectorAll(".nxt-error-email"),m=e.querySelectorAll(".nxt-message-error");e.querySelectorAll(".nxt-error-checkbox"),e.querySelectorAll(".nxt-error-radiobox");let p=e.querySelectorAll(".nxt-error-select"),x=e.querySelectorAll(".nxt-error-number");i.forEach((e,t)=>{e.addEventListener("input",()=>n(e,y[t]))}),c.forEach((e,t)=>{e.addEventListener("input",()=>a(e,h[t]))}),s.forEach((e,t)=>{e.addEventListener("input",()=>n(e,m[t]))}),u.forEach(e=>{let t=e.querySelectorAll('input[type="checkbox"]'),r=e.querySelector(".nxt-error-checkbox");t.forEach(e=>{e.addEventListener("change",()=>o(e,r))})}),d.forEach(e=>{let t=e.querySelectorAll('input[type="radio"]'),r=e.querySelector(".nxt-error-radiobox");t.forEach(e=>{e.addEventListener("change",()=>o(e,r))})}),f.forEach((e,t)=>{e.addEventListener("change",()=>n(e,p[t]))}),b.forEach((e,t)=>{e.addEventListener("input",()=>n(e,x[t]))});let q=()=>{let e=!0;return i.forEach((t,r)=>{if(t.hasAttribute("data-required")){let l=n(t,y[r]);e=e&&l}}),c.forEach((t,r)=>{if(t.hasAttribute("data-required")){let l=a(t,h[r]);e=e&&l}}),s.forEach((t,r)=>{if(t.hasAttribute("data-required")){let l=n(t,m[r]);e=e&&l}}),u.forEach(t=>{let r=t.querySelector('input[type="checkbox"]'),l=t.querySelector(".nxt-error-checkbox");if(r&&r.hasAttribute("data-required")){let a=o(r,l);e=e&&a}}),d.forEach(t=>{let r=t.querySelector('input[type="radio"]'),l=t.querySelector(".nxt-error-radiobox");if(r&&r.hasAttribute("data-required")){let a=o(r,l);e=e&&a}}),f.forEach((t,r)=>{if(t.hasAttribute("data-required")){let l=n(t,p[r]);e=e&&l}}),b.forEach((t,r)=>{if(t.hasAttribute("data-required")){let l=n(t,x[r]);e=e&&l}}),e},A=e.querySelector(".nxt-form");A&&(t=A.getAttribute("data-formdata")||"",A.addEventListener("submit",function l(a){a.preventDefault(),q()&&!r&&(r=!0,function t(l){let a=new FormData,n=t=>{if("checkbox"===t){let r=e.querySelector(".tp-form-checkbox-button");if(r){let l=r.querySelector(".nxt-check-title-label"),a=l?l.innerText.trim():t,n=Array.from(r.querySelectorAll('input[type="checkbox"]:checked')).map(e=>e.value);if(n.length>0)return[{label:a,value:n.join(", ")},]}return[]}return Array.from(e.querySelectorAll(`input[name='${t}'], textarea[name='${t}'], select[name='${t}']`)).filter(e=>"radio"===e.type?e.checked:e.value).map(e=>{let r="email"===e.type?e.closest(".nxt-email-input"):e.classList.contains("nxt-name-richtext")?e.closest(".nxt-name-input"):"number"===e.type?e.closest(".nxt-number-input"):e.parentElement,l=r?r.querySelector("label"):null;return{value:e.value,label:l?l.innerText.trim():t}})};["text-field","email","message","number","select","checkbox",].forEach(e=>n(e).forEach(e=>{a.append(e.label,e.value)})),Array.from(e.querySelectorAll('input[type="radio"]')).forEach(e=>{if(e.checked&&e.name.startsWith("radio-group")){let t=e.closest(".tp-form-radio-button"),r=t?t.querySelector(".nxt-radio-title-label"):null,l=r?r.innerText.trim():e.name;a.append(l,e.value)}}),a.append("actionOption",l||[]),a.append("action","nxt_form_action"),a.append("nonce",tpgb_config.tpgb_nonce);let o=A.hasAttribute("data-actionoption")&&""!==A.getAttribute("data-actionoption").trim()?JSON.parse(A.getAttribute("data-actionoption")).map(e=>e.value):"",i="",c="",s,u,d=(t,r)=>{let l=e.querySelector(".nxt-success-message");l&&(l.textContent=t,l.classList.remove("nxt-success-message","error-message"),l.classList.add(r?"error-message":"nxt-success-message"),l.style.display="block")};if(o&&Array.isArray(o)){let f=o.some(e=>"redirect"===e.toLowerCase());f&&A.hasAttribute("data-redirect")&&(i=A.getAttribute("data-redirect")),f&&A.hasAttribute("data-link-blank")&&(s=A.getAttribute("data-link-blank")),f&&A.hasAttribute("data-link-nofollow")&&(u=A.getAttribute("data-link-nofollow"));let b=o.some(e=>"email"===e.toLowerCase());b&&(c=!0)}let y=e=>{try{return new URL(e),!0}catch(t){return!1}};if(!o||0===o.length){d("No form action is selected.",!0),r=!1;return}if(q()){if(c){let h=e.querySelector(".nxt-submit"),m=h.querySelector(".nxt-loader"),p=h.querySelector(".nxt-button-svg"),x=h.querySelector(".nxt-btn-text");x&&(x.style.display="none"),p&&(p.style.display="none"),m.style.display="inline-block",fetch(tpgb_config.ajax_url,{method:"POST",body:a,credentials:"same-origin",headers:{"X-WP-Nonce":tpgb_config.tpgb_nonce}}).then(e=>e.json()).then(t=>{if(r=!1,m.style.display="none",p&&(p.style.display="inline-block"),x&&(x.style.display="inline-block"),t.success){let l=e.querySelector(".nxt-success-message").getAttribute("data-success-message")||"Your submission was successful.";d(l,!1),setTimeout(()=>{window.location.reload()},1e3)}else{let a=t.data||"Unknown error occurred.";d(a,!0),m.style.display="none",p&&(p.style.display="inline-block"),x&&(x.style.display="inline-block")}}).catch(e=>{m.style.display="none",p&&(p.style.display="inline-block"),x&&(x.style.display="inline-block"),d("An error occurred while sending the form data.",!0),r=!1})}setTimeout(()=>{if(i&&y(i)){if("1"===s){let e=window.open("","_blank");if("1"===u){let t=e.document.createElement("a");t.setAttribute("href",i),t.setAttribute("rel","nofollow"),e.document.body.appendChild(t),t.click()}else e.location.href=i}else window.location.href=i}},2e3)}}(t))}))}})});